---
trigger: model_decision
description: Схема бази даних для графа Grynya
globs: **/*.py, **/*.md, **/*.json
---

# Схема Графа Пам'яті "Grynya"

Цей документ описує еталонну схему графа `Grynya` для бази даних FalkorDB. Він використовується навичкою `memory-manager` та усіма суміжними скриптами.

## Вузли (Nodes)

Всі вузли повинні створюватися з вказаними ОБОВ'ЯЗКОВИМИ атрибутами.

| Тип вузла | Обов'язкові атрибути | Опис |
| :--- | :--- | :--- |
| `:Session` | `id`, `name`, `topic`, `status` (`active` або `closed`), `trigger` (`/db`, `/sa` або `/ss`) | Логічний контейнер всієї розмови. |
| `:Request` | `id`, `name`, `author` (завжди `user`), `text`, `type` (`text`, `command`) | Первинний запит користувача, що відкриває сесію. |
| `:Response` | `id`, `name`, `author` (завжди `Grynya`), `summary`, `full_text` (ПОВНИЙ текст відповіді СЛОВО В СЛОВО), `type` (`text`) | Відповідь агента. |
| `:Feedback` | `id`, `name`, `author` (завжди `user`), `text` | Коментар або уточнення від користувача в межах відкритої сесії. |
| `:Analysis` | `id`, `name`, `type` (`response_analysis` або `session_summary`), `verdict` (`correct`, `partially_correct`, `incorrect`), `rules_used`, `rules_ignored`, `errors`, `lessons` | Самоаналіз агента щодо власної відповіді або підсумок діалогу. |
| `:Entity` | `id`, `name` (CamelCase), `type` (`Technology`, `Concept`, `Project`, `Person`, `Rule`), `description` (українською) | Сутність, що фігурує в розмові (згадується постійно і витягується при кожному оновленні). |
| `:Year` | `id`, `name` (наприклад, `2026`), `value` (ціле число `2026`) | Рік події. |
| `:Day` | `id`, `name` (наприклад, `2026-02-22`), `date` (`YYYY-MM-DD`) | День події. |

## Зв'язки (Relationships)

Зв'язки між вузлами формують структуру та тимчасову хронологію сесії. Деякі зв'язки можуть мати обов'язкові атрибути.

| Тип зв'язку | Від | До | Атрибути | Опис |
| :--- | :--- | :--- | :--- | :--- |
| `[:PART_OF]` | Будь-який вузол сесії | `:Session` | Немає | Вказує належність Request, Response, Feedback або Analysis до конкретної сесії. |
| `[:RESPONDS_TO]` | `:Response` | `:Request` або `:Feedback` | Немає | Вказує, що саме спровокувало дану відповідь агента. |
| `[:FEEDBACK_ON]` | `:Feedback` | `:Response` | Немає | Вказує, до якої конкретної відповіді користувач написав коментар. |
| `[:ANALYZES]` | `:Analysis` | `:Response` | Немає | Агент аналізує свою конкретну відповідь. |
| `[:SUMMARIZES]`| `:Analysis` | `:Session` | Немає | Фінальний аналіз закриває сесію. |
| `[:NEXT]` | Будь-який вузол події | Будь-який вузол події | Немає | Формує ЄДИНУ сувору хронологічну лінію всіх подій (Request, Response, Feedback, Analysis) через усі сесії. Зв'язки між вузлами :Session не потрібні. |
| `[:LAST_EVENT]` | `:Session` | Будь-який вузол | Немає | Вказівник від сесії на найсвіжішу подію всередині неї. Оновлюється при кожній новій дії. |
| `[:MONTH]` | `:Year` | `:Day` | `number` (ціле число, наприклад `02`) | Зв'язує Рік з Днем, атрибут вказує номер місяця. |
| `[:HAPPENED_AT]`| Будь-який вузол | `:Day` | `time` (У форматі `HH:MM:SS`) | Точний час створення конкретного вузла (події). |
| `[:INVOLVES]` | `:Session` | `:Entity` | `context` (рядок, опціонально) | Сесія в цілому стосується цієї сутності. |
| `[:MENTIONS]` | `:Request`, `:Response`, `:Feedback`, `:Analysis` | `:Entity` | `relevance` (integer від 1 до 5, опціонально) | Конкретна подія згадує цю сутність. |

> [!TIP]
> **Примітка щодо `:Entity`:** Витяг сутностей — це безперервний процес. Агент повинен ідентифікувати та зв'язувати (`[:MENTIONS]`, `[:INVOLVES]`) всі релевантні сутності під час обробки **кожного** повідомлення (`Request`, `Response`, `Feedback`, `Analysis`), а не лише нові.
